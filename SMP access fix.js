import dotenv from 'dotenv'
dotenv.config()

import { Client, GatewayIntentBits } from 'discord.js'

const client = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.GuildMembers,
        GatewayIntentBits.DirectMessages
    ]
})

client.login(process.env.DISCORD_TOKEN);

const IDs = [
    '297959403116691457', '424711766539239426', '736179230064509018',
    '238614051964321792', '177905327507767296', '275175693757972480',
    '241527393465008128', '240682419450019841', '415434299710504963',
    '722309372058796106', '217923063826612224', '813386738676400139',
    '364550977984135169', '659379692826132481', '388788858319536139',
    '320180278729506816', '852329580680708157', '442254591602720768',
    '350581686842687488', '534941823492292619', '340706741664612353',
    '398430970451197955', '921399550579703818', '278452818875252736',
    '470390963735363587', '342541834599530497', '140542370990129152',
    '376241219828842497', '191110914517368833', '355348321885487104',
    '412730440865153046', '700484750363590776', '475696339162759169',
    '608769815385210961', '491522603303829505', '278333760259489803',
    '577100676581031947', '603488542563237890', '437248321703116801',
    '711385436471296100', '541918501414109204', '225128418356756480',
    '277730039309664256', '338182307850616844', '1073888572169531433',
    '808147859144704040', '1134657393385558026', '385734195269599232',
    '310188833792589825', '231965344955236354', '349721630500585493',
    '275649922995585024', '337852260342300682', '168306031208824832',
    '299342357797535745', '374407833984434176', '418257623414996994',
    '411425814647930880', '160578271468191744', '428457249179172865',
    '336109747503890432', '277516988807512064', '299544094563106816',
    '534276166438092801', '378552869823053824', '386128981092728846',
    '200497314731786259', '423002573814104076', '317564340842528768',
    '934535403157999676', '390015328526139392', '315848943315582986',
    '226228238643494912', '192678564024287232', '304484622593687563',
    '246770493187686410', '285006222162395137', '318652720087171083',
    '612976534101295104', '97916741467770880', '317600726954016769'
]

client.on('ready', () =>
{
    const guild = client.guilds.cache.get("1084629233248260126")
    if (!guild)
    {
        console.error("Guild not found");
        return;
    }

    const role = guild.roles.cache.get("1129360016013525042");
    if (!role)
    {
        console.error("Role not found");
        return;
    }

    const promises = IDs.map(id =>
    {
        return guild.members.fetch(id)
            .then(member =>
            {
                if (member)
                {
                    return member.roles.add(role).then(() => member).catch(error =>
                    {
                        console.error(`Error adding role to member ${id}:`, error);
                        return null;
                    });
                }
            })
            .catch(error =>
            {
                console.error(`Error fetching member ${id}:`, error);
                return null;
            });
    });

    Promise.all(promises)
        .then(members =>
        {
            const successfulMembers = members.filter(member => member !== null);
            console.log(`Successfully added role to ${successfulMembers.length} members.`);
        })
        .catch(error =>
        {
            console.error("An error occurred during role assignment:", error);
        });
});
